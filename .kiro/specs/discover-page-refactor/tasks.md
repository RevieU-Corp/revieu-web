# Implementation Plan: DiscoverPage 重构

## Overview

本实施计划将 DiscoverPage 重构分解为一系列增量开发任务。重构将创建三个分类 widget（美食、美容服务、购物娱乐）和基于用户收藏的个性化推荐系统，确保 16:9 手机屏幕的最佳体验。

## Tasks

- [x] 1. 设置项目结构和核心接口
  - 创建分类数据常量和类型定义
  - 定义组件接口和状态管理结构
  - 设置测试框架配置
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2. 实现分类 Widget 组件
  - [x] 2.1 创建 CategoryWidget 基础组件
    - 实现可重用的分类 widget 组件
    - 支持水平滚动和单选模式
    - _Requirements: 1.1, 2.1, 3.1_

  - [ ]* 2.2 为 CategoryWidget 编写属性测试
    - **Property 2: 单选模式行为**
    - **Validates: Requirements 1.4, 2.4, 3.4**

  - [x] 2.3 实现美食分类 Widget
    - 集成美食分类数据和图片
    - 实现分类筛选逻辑
    - _Requirements: 1.2, 1.3, 1.4_

  - [ ]* 2.4 为美食分类编写属性测试
    - **Property 1: 分类筛选一致性**
    - **Validates: Requirements 1.3, 6.1, 6.2**

- [x] 3. 实现美容服务和购物娱乐 Widget
  - [x] 3.1 创建美容服务分类 Widget
    - 实现美容服务分类按钮和筛选
    - _Requirements: 2.2, 2.3, 2.4_

  - [x] 3.2 创建购物娱乐分类 Widget
    - 实现购物娱乐分类按钮和筛选
    - _Requirements: 3.2, 3.3, 3.4_

  - [ ]* 3.3 为所有分类 Widget 编写集成测试
    - 测试三个 widget 的协同工作
    - _Requirements: 2.5, 3.5_

- [x] 4. 检查点 - 确保分类功能正常工作
  - 确保所有测试通过，如有问题请询问用户

- [x] 5. 实现推荐系统核心逻辑
  - [x] 5.1 创建推荐算法组件
    - 实现基于用户收藏的推荐逻辑
    - 实现地理范围筛选（5英里）
    - _Requirements: 4.2, 4.4_

  - [ ]* 5.2 为推荐算法编写属性测试
    - **Property 3: 地理范围限制**
    - **Property 5: 基于收藏的推荐准确性**
    - **Validates: Requirements 4.2, 4.4**

  - [x] 5.3 实现默认推荐逻辑
    - 当用户无收藏时推荐高评分商家
    - _Requirements: 4.3_

  - [ ]* 5.4 为推荐排序编写属性测试
    - **Property 4: 推荐排序正确性**
    - **Validates: Requirements 4.5**

- [x] 6. 实现推荐系统 UI 组件
  - [x] 6.1 创建 RecommendationSection 组件
    - 实现推荐区域布局（占用下半屏）
    - 集成推荐算法和商家列表显示
    - _Requirements: 4.1, 4.5_

  - [x] 6.2 实现空状态和错误处理
    - 创建空推荐状态组件
    - 实现网络错误和加载状态
    - _Requirements: 4.6_

  - [ ]* 6.3 为推荐 UI 编写单元测试
    - 测试空状态和错误状态显示
    - _Requirements: 4.6_

- [x] 7. 实现移动端布局优化
  - [x] 7.1 优化 16:9 屏幕布局
    - 调整组件尺寸和间距
    - 确保触控友好的交互元素
    - _Requirements: 5.1, 5.2, 5.3, 5.5_

  - [ ]* 7.2 为移动端适配编写属性测试
    - **Property 6: 触控元素尺寸适配**
    - **Validates: Requirements 5.5**

  - [x] 7.3 实现垂直滚动和响应式设计
    - 确保推荐内容可滚动浏览
    - _Requirements: 5.6_

- [x] 8. 集成搜索功能协同工作
  - [x] 8.1 实现分类与搜索的协同筛选
    - 确保搜索和分类筛选同时生效
    - _Requirements: 6.5_

  - [ ]* 8.2 为搜索协同编写属性测试
    - **Property 7: 分类与搜索协同工作**
    - **Validates: Requirements 6.5**

- [x] 9. 实现防抖和性能优化
  - [x] 9.1 添加防抖机制
    - 实现快速点击防护
    - 添加加载状态和视觉反馈
    - _Requirements: 6.1_

  - [x] 9.2 性能优化
    - 实现 React.memo 和 useMemo 优化
    - 添加图片懒加载
    - _Requirements: 5.1_

- [x] 10. 确保设计一致性
  - [x] 10.1 应用 HomePage 设计风格
    - 使用一致的颜色方案和字体
    - 保持按钮和卡片样式一致
    - _Requirements: 7.1, 7.2, 7.3, 7.4_

  - [x] 10.2 集成导航元素
    - 确保与现有导航组件兼容
    - _Requirements: 7.5_

- [x] 11. 最终检查点 - 确保所有功能正常工作
  - 确保所有测试通过，如有问题请询问用户

## Notes

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边界情况